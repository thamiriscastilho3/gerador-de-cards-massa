<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Cards - Ciclo 2 Boticário</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        :root {
            --cor-primaria: #ab2427; /* Tom de vermelho do modelo */
            --cor-texto-legal: #666;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background-color: #f0f0f0; }
        
        /* Layout de Trabalho */
        .container-criacao { display: flex; gap: 40px; width: 95%; max-width: 1800px; }
        #formulario-entrada { flex: 1; padding: 25px; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .step { display: none; }
        .step.active { display: block; }
        
        /* Tabela de Dados */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.85em; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f8f8; }

        /* Estilização do Card (1080x1350) */
        #card-preview {
            width: 540px; /* Metade de 1080 para visualização */
            height: 675px; /* Metade de 1350 para visualização */
            position: relative;
            overflow: hidden;
            background-image: url('https://raw.githubusercontent.com/thamiriscastilho3/gerador-de-cards-massa/main/assets/background-card.png.png');
            background-size: 100% 100%;
            background-color: #fff;
            flex-shrink: 0;
        }

        /* Títulos e Subtítulos */
        #card-header {
            position: absolute;
            top: 60px;
            width: 100%;
            text-align: center;
            z-index: 10;
        }
        #card-titulo { color: #fff; font-size: 28px; font-weight: 800; margin: 0; text-transform: uppercase; }
        #card-subtitulo { color: #fff; font-size: 16px; font-weight: 400; margin-top: 5px; }

        /* Selo de Faixa */
        #card-faixa {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: var(--cor-primaria);
            padding: 5px 20px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 14px;
            z-index: 10;
        }

        /* Imagem do Produto */
        #card-imagem-area {
            position: absolute;
            top: 220px;
            left: 50%;
            transform: translateX(-50%);
            width: 350px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }
        #card-imagem { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; }

        /* Container de Preços */
        .precos-box {
            position: absolute;
            bottom: 160px;
            right: 40px;
            text-align: right;
            color: #fff;
            z-index: 10;
        }
        .venda-por { font-size: 14px; margin-bottom: -5px; opacity: 0.9; }
        .valor-promocionado { font-size: 22px; font-weight: 300; text-decoration: line-through; margin-bottom: 5px; }
        .compre-por-label { font-size: 18px; font-weight: 800; color: #fff; }
        .valor-principal { font-size: 55px; font-weight: 900; line-height: 1; }
        .valor-principal span { font-size: 20px; }

        /* Rodapé com Informações do Produto */
        #card-footer {
            position: absolute;
            bottom: 60px;
            width: 100%;
            background: var(--cor-primaria);
            padding: 10px 0;
            color: #fff;
            text-align: center;
        }
        #card-sku { font-size: 12px; margin: 0; }
        #card-nome-produto { font-size: 14px; font-weight: 700; margin: 0; padding: 0 20px; }

        /* Texto Legal */
        #card-legal {
            position: absolute;
            bottom: 10px;
            width: 100%;
            font-size: 8px;
            color: var(--cor-texto-legal);
            padding: 0 30px;
            text-align: center;
            line-height: 1.1;
        }

        .download-btn { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container-criacao">
        <div id="formulario-entrada">
            <h1>Gerador de Cards Ciclo 2</h1>
            
            <div id="step-1" class="step active">
                <h3>Passo 1: Carregar Planilha CSV</h3>
                <input type="file" id="input-csv" accept=".csv">
                <p><small>Certifique-se que as colunas são: Título Principal, SUBTÍTULO, FAIXA, VENDA POR, valor promocionado, COMPRE POR, SKU, Nome do Produto, (TEXTO LEGAL)</small></p>
            </div>

            <div id="step-2" class="step">
                <h3>Passo 2: Imagens e Gerenciamento</h3>
                <button onclick="gerarTodosCards()" class="download-btn">Baixar Todos em ZIP (1080x1350)</button>
                <div style="overflow-y: auto; max-height: 400px;">
                    <table id="data-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>SKU</th>
                                <th>Imagem</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="card-preview">
            <div id="card-header">
                <p id="card-titulo">TÍTULO</p>
                <p id="card-subtitulo">SUBTÍTULO</p>
            </div>

            <div id="card-faixa">FAIXA</div>

            <div id="card-imagem-area">
                <div id="card-imagem"></div>
            </div>

            <div class="precos-box">
                <div class="venda-por">Venda por:</div>
                <div id="valor-promocionado" class="valor-promocionado">R$ 0,00</div>
                <div class="compre-por-label">COMPRE POR:</div>
                <div id="valor-principal" class="valor-principal"><span>R$</span> 00,00</div>
            </div>

            <div id="card-footer">
                <p id="card-sku">SKU 00000</p>
                <p id="card-nome-produto">NOME DO PRODUTO EXEMPLO</p>
            </div>

            <div id="card-legal">Texto legal informativo aqui...</div>
        </div>
    </div>

    <script>
        let dadosCards = [];

        document.getElementById('input-csv').addEventListener('change', function(e) {
            Papa.parse(e.target.files[0], {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    dadosCards = results.data;
                    renderizarTabela();
                    document.getElementById('step-1').classList.remove('active');
                    document.getElementById('step-2').classList.add('active');
                    atualizarPreview(0);
                }
            });
        });

        function renderizarTabela() {
            const tbody = document.querySelector('#data-table tbody');
            tbody.innerHTML = '';
            dadosCards.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item['Nome do Produto']}</td>
                    <td>${item['SKU']}</td>
                    <td><input type="file" onchange="carregarImagem(event, ${index})"></td>
                    <td><button onclick="atualizarPreview(${index})">Ver</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function carregarImagem(event, index) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                dadosCards[index].imagemData = e.target.result;
                atualizarPreview(index);
            };
            reader.readAsDataURL(file);
        }

        function atualizarPreview(index) {
            const item = dadosCards[index];
            document.getElementById('card-titulo').innerText = item['Título Principal'] || '';
            document.getElementById('card-subtitulo').innerText = item['SUBTÍTULO'] || '';
            document.getElementById('card-faixa').innerText = item['FAIXA'] || '';
            document.getElementById('valor-promocionado').innerText = item['valor promocionado'] || '';
            
            // Tratamento do preço principal
            let preco = item['COMPRE POR'] || '0,00';
            preco = preco.replace('R$', '').trim();
            document.getElementById('valor-principal').innerHTML = `<span>R$</span> ${preco}`;
            
            document.getElementById('card-sku').innerText = `SKU ${item['SKU']}`;
            document.getElementById('card-nome-produto').innerText = item['Nome do Produto'];
            document.getElementById('card-legal').innerText = item['(TEXTO LEGAL)'] || '';
            
            const imgDiv = document.getElementById('card-imagem');
            imgDiv.style.backgroundImage = item.imagemData ? `url(${item.imagemData})` : 'none';
        }

        async function gerarTodosCards() {
            const zip = new JSZip();
            const originalScale = 2; // Para chegar nos 1080x1350 (540 * 2)

            for (let i = 0; i < dadosCards.length; i++) {
                atualizarPreview(i);
                await new Promise(r => setTimeout(r, 100)); // Espera render
                
                const canvas = await html2canvas(document.getElementById('card-preview'), {
                    scale: originalScale,
                    useCORS: true
                });
                
                const imgData = canvas.toDataURL("image/png").split(',')[1];
                zip.file(`card_${dadosCards[i].SKU}.png`, imgData, {base64: true});
            }

            zip.generateAsync({type:"blob"}).then(content => {
                saveAs(content, "cards_boticario_ciclo2.zip");
            });
        }
    </script>
</body>
</html>
